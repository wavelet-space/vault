<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <title>Document</title>
</head>

<body>
    <canvas id="canvas"></canvas>
</body>
<script>
    DATA = {
        "Meta Data": {
            "1. Information": "Daily Prices (open, high, low, close) and Volumes",
            "2. Symbol": "aapl",
            "3. Last Refreshed": "2023-11-20",
            "4. Output Size": "Compact",
            "5. Time Zone": "US/Eastern"
        },
        "Time Series (Daily)": {
            "2023-11-20": {
                "1. open": "189.8900",
                "2. high": "191.9050",
                "3. low": "189.8800",
                "4. close": "191.4500",
                "5. volume": "46538614"
            },
            "2023-11-17": {
                "1. open": "190.2500",
                "2. high": "190.3800",
                "3. low": "188.5700",
                "4. close": "189.6900",
                "5. volume": "50941404"
            },
            "2023-11-16": {
                "1. open": "189.5700",
                "2. high": "190.9600",
                "3. low": "188.6500",
                "4. close": "189.7100",
                "5. volume": "54412915"
            },
            "2023-11-15": {
                "1. open": "187.8450",
                "2. high": "189.5000",
                "3. low": "187.7800",
                "4. close": "188.0100",
                "5. volume": "53790499"
            },
            "2023-11-14": {
                "1. open": "187.7000",
                "2. high": "188.1100",
                "3. low": "186.3000",
                "4. close": "187.4400",
                "5. volume": "60108378"
            },
            "2023-11-13": {
                "1. open": "185.8200",
                "2. high": "186.0300",
                "3. low": "184.2100",
                "4. close": "184.8000",
                "5. volume": "43627519"
            },
            "2023-11-10": {
                "1. open": "183.9700",
                "2. high": "186.5650",
                "3. low": "183.5300",
                "4. close": "186.4000",
                "5. volume": "66177922"
            },
            "2023-11-09": {
                "1. open": "182.9600",
                "2. high": "184.1200",
                "3. low": "181.8100",
                "4. close": "182.4100",
                "5. volume": "53763540"
            },
            "2023-11-08": {
                "1. open": "182.3500",
                "2. high": "183.4500",
                "3. low": "181.5900",
                "4. close": "182.8900",
                "5. volume": "49340282"
            },
            "2023-11-07": {
                "1. open": "179.1800",
                "2. high": "182.4400",
                "3. low": "178.9700",
                "4. close": "181.8200",
                "5. volume": "70529966"
            },
            "2023-11-06": {
                "1. open": "176.3800",
                "2. high": "179.4300",
                "3. low": "176.2100",
                "4. close": "179.2300",
                "5. volume": "63841310"
            },
            "2023-11-03": {
                "1. open": "174.2400",
                "2. high": "176.8200",
                "3. low": "173.3500",
                "4. close": "176.6500",
                "5. volume": "79829246"
            },
            "2023-11-02": {
                "1. open": "175.5200",
                "2. high": "177.7800",
                "3. low": "175.4600",
                "4. close": "177.5700",
                "5. volume": "77334752"
            },
            "2023-11-01": {
                "1. open": "171.0000",
                "2. high": "174.2300",
                "3. low": "170.1200",
                "4. close": "173.9700",
                "5. volume": "56934906"
            },
            "2023-10-31": {
                "1. open": "169.3500",
                "2. high": "170.9000",
                "3. low": "167.9000",
                "4. close": "170.7700",
                "5. volume": "44846017"
            },
            "2023-10-30": {
                "1. open": "169.0200",
                "2. high": "171.1700",
                "3. low": "168.8700",
                "4. close": "170.2900",
                "5. volume": "51130955"
            },
            "2023-10-27": {
                "1. open": "166.9100",
                "2. high": "168.9600",
                "3. low": "166.8300",
                "4. close": "168.2200",
                "5. volume": "58499129"
            },
            "2023-10-26": {
                "1. open": "170.3700",
                "2. high": "171.3775",
                "3. low": "165.6700",
                "4. close": "166.8900",
                "5. volume": "70625258"
            },
            "2023-10-25": {
                "1. open": "171.8800",
                "2. high": "173.0600",
                "3. low": "170.6500",
                "4. close": "171.1000",
                "5. volume": "57156962"
            },
            "2023-10-24": {
                "1. open": "173.0500",
                "2. high": "173.6700",
                "3. low": "171.4500",
                "4. close": "173.4400",
                "5. volume": "43816644"
            },
            "2023-10-23": {
                "1. open": "170.9100",
                "2. high": "174.0100",
                "3. low": "169.9300",
                "4. close": "173.0000",
                "5. volume": "55980109"
            },
            "2023-10-20": {
                "1. open": "175.3100",
                "2. high": "175.4200",
                "3. low": "172.6400",
                "4. close": "172.8800",
                "5. volume": "64244028"
            },
            "2023-10-19": {
                "1. open": "176.0400",
                "2. high": "177.8400",
                "3. low": "175.1900",
                "4. close": "175.4600",
                "5. volume": "59302863"
            },
            "2023-10-18": {
                "1. open": "175.5800",
                "2. high": "177.5750",
                "3. low": "175.1100",
                "4. close": "175.8400",
                "5. volume": "54764375"
            },
            "2023-10-17": {
                "1. open": "176.6450",
                "2. high": "178.4200",
                "3. low": "174.8000",
                "4. close": "177.1500",
                "5. volume": "57549350"
            },
            "2023-10-16": {
                "1. open": "176.7500",
                "2. high": "179.0750",
                "3. low": "176.5100",
                "4. close": "178.7200",
                "5. volume": "52516984"
            },
            "2023-10-13": {
                "1. open": "181.4200",
                "2. high": "181.9300",
                "3. low": "178.1400",
                "4. close": "178.8500",
                "5. volume": "51456082"
            },
            "2023-10-12": {
                "1. open": "180.0700",
                "2. high": "182.3400",
                "3. low": "179.0400",
                "4. close": "180.7100",
                "5. volume": "56743119"
            },
            "2023-10-11": {
                "1. open": "178.2000",
                "2. high": "179.8500",
                "3. low": "177.6000",
                "4. close": "179.8000",
                "5. volume": "47551098"
            },
            "2023-10-10": {
                "1. open": "178.1000",
                "2. high": "179.7200",
                "3. low": "177.9500",
                "4. close": "178.3900",
                "5. volume": "43698019"
            },
            "2023-10-09": {
                "1. open": "176.8100",
                "2. high": "179.0500",
                "3. low": "175.8000",
                "4. close": "178.9900",
                "5. volume": "42390772"
            },
            "2023-10-06": {
                "1. open": "173.8000",
                "2. high": "177.9900",
                "3. low": "173.1800",
                "4. close": "177.4900",
                "5. volume": "57266675"
            },
            "2023-10-05": {
                "1. open": "173.7900",
                "2. high": "175.4500",
                "3. low": "172.6800",
                "4. close": "174.9100",
                "5. volume": "48527918"
            },
            "2023-10-04": {
                "1. open": "171.0900",
                "2. high": "174.2100",
                "3. low": "170.9700",
                "4. close": "173.6600",
                "5. volume": "53020286"
            },
            "2023-10-03": {
                "1. open": "172.2550",
                "2. high": "173.6300",
                "3. low": "170.8200",
                "4. close": "172.4000",
                "5. volume": "49594613"
            },
            "2023-10-02": {
                "1. open": "171.2200",
                "2. high": "174.3000",
                "3. low": "170.9300",
                "4. close": "173.7500",
                "5. volume": "52164535"
            },
            "2023-09-29": {
                "1. open": "172.0200",
                "2. high": "173.0700",
                "3. low": "170.3410",
                "4. close": "171.2100",
                "5. volume": "51861083"
            },
            "2023-09-28": {
                "1. open": "169.3400",
                "2. high": "172.0300",
                "3. low": "167.6200",
                "4. close": "170.6900",
                "5. volume": "56294419"
            },
            "2023-09-27": {
                "1. open": "172.6200",
                "2. high": "173.0400",
                "3. low": "169.0500",
                "4. close": "170.4300",
                "5. volume": "66921808"
            },
            "2023-09-26": {
                "1. open": "174.8200",
                "2. high": "175.2000",
                "3. low": "171.6600",
                "4. close": "171.9600",
                "5. volume": "64588945"
            },
            "2023-09-25": {
                "1. open": "174.2000",
                "2. high": "176.9700",
                "3. low": "174.1500",
                "4. close": "176.0800",
                "5. volume": "46172740"
            },
            "2023-09-22": {
                "1. open": "174.6700",
                "2. high": "177.0790",
                "3. low": "174.0500",
                "4. close": "174.7900",
                "5. volume": "56725385"
            },
            "2023-09-21": {
                "1. open": "174.5500",
                "2. high": "176.3000",
                "3. low": "173.8600",
                "4. close": "173.9300",
                "5. volume": "63149116"
            },
            "2023-09-20": {
                "1. open": "179.2600",
                "2. high": "179.6950",
                "3. low": "175.4000",
                "4. close": "175.4900",
                "5. volume": "58436181"
            },
            "2023-09-19": {
                "1. open": "177.5200",
                "2. high": "179.6300",
                "3. low": "177.1300",
                "4. close": "179.0700",
                "5. volume": "51826941"
            },
            "2023-09-18": {
                "1. open": "176.4800",
                "2. high": "179.3800",
                "3. low": "176.1700",
                "4. close": "177.9700",
                "5. volume": "67257573"
            },
            "2023-09-15": {
                "1. open": "176.4800",
                "2. high": "176.4950",
                "3. low": "173.8200",
                "4. close": "175.0100",
                "5. volume": "109259461"
            },
            "2023-09-14": {
                "1. open": "174.0000",
                "2. high": "176.1000",
                "3. low": "173.5800",
                "4. close": "175.7400",
                "5. volume": "60895757"
            },
            "2023-09-13": {
                "1. open": "176.5100",
                "2. high": "177.3000",
                "3. low": "173.9800",
                "4. close": "174.2100",
                "5. volume": "84267928"
            },
            "2023-09-12": {
                "1. open": "179.4900",
                "2. high": "180.1300",
                "3. low": "174.8200",
                "4. close": "176.3000",
                "5. volume": "90370192"
            },
            "2023-09-11": {
                "1. open": "180.0700",
                "2. high": "180.3000",
                "3. low": "177.3400",
                "4. close": "179.3600",
                "5. volume": "58953052"
            },
            "2023-09-08": {
                "1. open": "178.3500",
                "2. high": "180.2390",
                "3. low": "177.7900",
                "4. close": "178.1800",
                "5. volume": "65602066"
            },
            "2023-09-07": {
                "1. open": "175.1800",
                "2. high": "178.2100",
                "3. low": "173.5400",
                "4. close": "177.5600",
                "5. volume": "112488803"
            },
            "2023-09-06": {
                "1. open": "188.4000",
                "2. high": "188.8500",
                "3. low": "181.4700",
                "4. close": "182.9100",
                "5. volume": "81755816"
            },
            "2023-09-05": {
                "1. open": "188.2800",
                "2. high": "189.9800",
                "3. low": "187.6100",
                "4. close": "189.7000",
                "5. volume": "45280027"
            },
            "2023-09-01": {
                "1. open": "189.4850",
                "2. high": "189.9200",
                "3. low": "188.2800",
                "4. close": "189.4600",
                "5. volume": "45766503"
            },
            "2023-08-31": {
                "1. open": "187.8400",
                "2. high": "189.1200",
                "3. low": "187.4800",
                "4. close": "187.8700",
                "5. volume": "60794467"
            },
            "2023-08-30": {
                "1. open": "184.9400",
                "2. high": "187.8500",
                "3. low": "184.7400",
                "4. close": "187.6500",
                "5. volume": "60813888"
            },
            "2023-08-29": {
                "1. open": "179.6950",
                "2. high": "184.9000",
                "3. low": "179.5000",
                "4. close": "184.1200",
                "5. volume": "53003948"
            },
            "2023-08-28": {
                "1. open": "180.0900",
                "2. high": "180.5900",
                "3. low": "178.5450",
                "4. close": "180.1900",
                "5. volume": "43820697"
            },
            "2023-08-25": {
                "1. open": "177.3800",
                "2. high": "179.1500",
                "3. low": "175.8200",
                "4. close": "178.6100",
                "5. volume": "51449594"
            },
            "2023-08-24": {
                "1. open": "180.6740",
                "2. high": "181.1040",
                "3. low": "176.0100",
                "4. close": "176.3800",
                "5. volume": "54945798"
            },
            "2023-08-23": {
                "1. open": "178.5200",
                "2. high": "181.5500",
                "3. low": "178.3250",
                "4. close": "181.1200",
                "5. volume": "52722752"
            },
            "2023-08-22": {
                "1. open": "177.0600",
                "2. high": "177.6800",
                "3. low": "176.2500",
                "4. close": "177.2300",
                "5. volume": "42084245"
            },
            "2023-08-21": {
                "1. open": "175.0700",
                "2. high": "176.1300",
                "3. low": "173.7350",
                "4. close": "175.8400",
                "5. volume": "46311879"
            },
            "2023-08-18": {
                "1. open": "172.3000",
                "2. high": "175.1000",
                "3. low": "171.9600",
                "4. close": "174.4900",
                "5. volume": "61172150"
            },
            "2023-08-17": {
                "1. open": "177.1400",
                "2. high": "177.5054",
                "3. low": "173.4800",
                "4. close": "174.0000",
                "5. volume": "66062882"
            },
            "2023-08-16": {
                "1. open": "177.1300",
                "2. high": "178.5400",
                "3. low": "176.5000",
                "4. close": "176.5700",
                "5. volume": "46964857"
            },
            "2023-08-15": {
                "1. open": "178.8800",
                "2. high": "179.4800",
                "3. low": "177.0500",
                "4. close": "177.4500",
                "5. volume": "43622593"
            },
            "2023-08-14": {
                "1. open": "177.9700",
                "2. high": "179.6900",
                "3. low": "177.3050",
                "4. close": "179.4600",
                "5. volume": "43675627"
            },
            "2023-08-11": {
                "1. open": "177.3200",
                "2. high": "178.6200",
                "3. low": "176.5500",
                "4. close": "177.7900",
                "5. volume": "52036672"
            },
            "2023-08-10": {
                "1. open": "179.4800",
                "2. high": "180.7500",
                "3. low": "177.6000",
                "4. close": "177.9700",
                "5. volume": "54686851"
            },
            "2023-08-09": {
                "1. open": "180.8700",
                "2. high": "180.9300",
                "3. low": "177.0100",
                "4. close": "178.1900",
                "5. volume": "60378492"
            },
            "2023-08-08": {
                "1. open": "179.6900",
                "2. high": "180.2700",
                "3. low": "177.5800",
                "4. close": "179.8000",
                "5. volume": "67823003"
            },
            "2023-08-07": {
                "1. open": "182.1300",
                "2. high": "183.1300",
                "3. low": "177.3500",
                "4. close": "178.8500",
                "5. volume": "97576069"
            },
            "2023-08-04": {
                "1. open": "185.5200",
                "2. high": "187.3800",
                "3. low": "181.9200",
                "4. close": "181.9900",
                "5. volume": "115956841"
            },
            "2023-08-03": {
                "1. open": "191.5700",
                "2. high": "192.3700",
                "3. low": "190.6900",
                "4. close": "191.1700",
                "5. volume": "62243282"
            },
            "2023-08-02": {
                "1. open": "195.0400",
                "2. high": "195.1800",
                "3. low": "191.8507",
                "4. close": "192.5800",
                "5. volume": "50389327"
            },
            "2023-08-01": {
                "1. open": "196.2350",
                "2. high": "196.7300",
                "3. low": "195.2800",
                "4. close": "195.6050",
                "5. volume": "35281426"
            },
            "2023-07-31": {
                "1. open": "196.0600",
                "2. high": "196.4900",
                "3. low": "195.2600",
                "4. close": "196.4500",
                "5. volume": "38824113"
            },
            "2023-07-28": {
                "1. open": "194.6700",
                "2. high": "196.6260",
                "3. low": "194.1400",
                "4. close": "195.8300",
                "5. volume": "48291443"
            },
            "2023-07-27": {
                "1. open": "196.0200",
                "2. high": "197.2000",
                "3. low": "192.5500",
                "4. close": "193.2200",
                "5. volume": "47460180"
            },
            "2023-07-26": {
                "1. open": "193.6700",
                "2. high": "195.6400",
                "3. low": "193.3200",
                "4. close": "194.5000",
                "5. volume": "47471868"
            },
            "2023-07-25": {
                "1. open": "193.3300",
                "2. high": "194.4400",
                "3. low": "192.9150",
                "4. close": "193.6200",
                "5. volume": "37283201"
            },
            "2023-07-24": {
                "1. open": "193.4100",
                "2. high": "194.9100",
                "3. low": "192.2500",
                "4. close": "192.7500",
                "5. volume": "45505097"
            },
            "2023-07-21": {
                "1. open": "194.1000",
                "2. high": "194.9700",
                "3. low": "191.2300",
                "4. close": "191.9400",
                "5. volume": "71951683"
            },
            "2023-07-20": {
                "1. open": "195.0900",
                "2. high": "196.4700",
                "3. low": "192.4950",
                "4. close": "193.1300",
                "5. volume": "59581196"
            },
            "2023-07-19": {
                "1. open": "193.1000",
                "2. high": "198.2300",
                "3. low": "192.6500",
                "4. close": "195.1000",
                "5. volume": "80507323"
            },
            "2023-07-18": {
                "1. open": "193.3500",
                "2. high": "194.3300",
                "3. low": "192.4150",
                "4. close": "193.7300",
                "5. volume": "48353774"
            },
            "2023-07-17": {
                "1. open": "191.9000",
                "2. high": "194.3200",
                "3. low": "191.8100",
                "4. close": "193.9900",
                "5. volume": "50520159"
            },
            "2023-07-14": {
                "1. open": "190.2300",
                "2. high": "191.1799",
                "3. low": "189.6300",
                "4. close": "190.6900",
                "5. volume": "41616242"
            },
            "2023-07-13": {
                "1. open": "190.5000",
                "2. high": "191.1900",
                "3. low": "189.7800",
                "4. close": "190.5400",
                "5. volume": "41342338"
            },
            "2023-07-12": {
                "1. open": "189.6800",
                "2. high": "191.7000",
                "3. low": "188.4700",
                "4. close": "189.7700",
                "5. volume": "60750248"
            },
            "2023-07-11": {
                "1. open": "189.1600",
                "2. high": "189.3000",
                "3. low": "186.6000",
                "4. close": "188.0800",
                "5. volume": "46638119"
            },
            "2023-07-10": {
                "1. open": "189.2600",
                "2. high": "189.9900",
                "3. low": "187.0350",
                "4. close": "188.6100",
                "5. volume": "59922163"
            },
            "2023-07-07": {
                "1. open": "191.4100",
                "2. high": "192.6700",
                "3. low": "190.2400",
                "4. close": "190.6800",
                "5. volume": "46814998"
            },
            "2023-07-06": {
                "1. open": "189.8400",
                "2. high": "192.0200",
                "3. low": "189.2000",
                "4. close": "191.8100",
                "5. volume": "45156009"
            },
            "2023-07-05": {
                "1. open": "191.5650",
                "2. high": "192.9800",
                "3. low": "190.6200",
                "4. close": "191.3300",
                "5. volume": "46920261"
            },
            "2023-07-03": {
                "1. open": "193.7800",
                "2. high": "193.8800",
                "3. low": "191.7600",
                "4. close": "192.4600",
                "5. volume": "31458198"
            },
            "2023-06-30": {
                "1. open": "191.6300",
                "2. high": "194.4800",
                "3. low": "191.2600",
                "4. close": "193.9700",
                "5. volume": "85213216"
            }
        }
    }

    let candleOhlcMappings = [];

    let info = {
        yMin: [],
        xMin: [],
        yMax: [],
        xMax: [],
        l: 0,
        h: 0,
        minDate: "",
        maxDate: "",
    }


    let GLOBAL_WIDTH = window.innerWidth / 1 - 30;
    let GLOBAL_HEIGHT = window.innerHeight / 2 - 30;

    let canvas = document.getElementById("canvas");
    canvas.width = GLOBAL_WIDTH;
    canvas.height = GLOBAL_HEIGHT;

    let ctx = canvas.getContext("2d");

    let centerPoint = [GLOBAL_WIDTH / 2, GLOBAL_HEIGHT / 2];
    let boundaries = [GLOBAL_WIDTH - 50, GLOBAL_HEIGHT - 50];


    // The amount of grid lines to evenly distribute for each axis.
    var GLOBAL_YLINES = 12;
    var GLOBAL_XLINES = 12;

    function getTimeslots(ohlc, width) {
        return width / ohlc.length;
    }

    /** 
     * Calculate how many horizontal and vertical lines to render across the X and Y axis.
     */
    function calculateSteps(width, height, xlines, ylines, info) {
        let ySteps = [...Array(xlines + 1).keys()].map(
            i => Math.floor(i * (height / xlines)));

        let xSteps = [...Array(ylines + 1).keys()].map(
            i => Math.floor(i * (width / ylines)));

        // FIXME GLOBAL VARIABLE
        info.yMin = [0, 0]
        info.yMax = [0, ySteps[ySteps.length - 1]]
        info.xMin = [0, 0]
        info.xMax = [xSteps[xSteps.length - 1], 0]

        return [xSteps, ySteps];
    }

    class Renderer {

        constructor(context) {
            this.context = context
        }

        renderLine(start, end, color = "black", width = 1) {
            this.context.lineWidth = width;
            this.context.save()
            this.context.beginPath();
            this.context.strokeStyle = color
            this.context.moveTo(start[0], start[1]);
            this.context.lineTo(end[0], end[1]);
            this.context.closePath();
            this.context.stroke();
            this.context.restore()
        }

        renderGrid(lp, hp, dateRange, steps) {
            let drawHorizontal = (yPoints) => {
                this.renderLine([0, 0], [this.context.canvas.width, 0]);
                for (var point of yPoints) {
                    this.renderLine([0, point], [this.context.canvas.width, point], "grey")
                }
            }
            let drawVertical = (xPoints) => {
                this.renderLine([0, 0], [0, this.context.canvas.height]);

                for (var point of xPoints) {
                    this.renderLine([point, this.context.canvas.height], [point, 0], "grey")
                }
            }

            let [vstep, hstep] = steps;

            drawVertical(vstep)
            drawHorizontal(hstep)
        }

        // 0 Time, 1 Open, 2 High, 3 Low, 4 Close
        renderTicks(ohlc, dateRange, lp, hp, steps) {
            let timeSlot = getTimeslots(ohlc, GLOBAL_WIDTH);
            let idx = 0;
            for (var candle of ohlc) {
                let calculatePosition = (price) => info.yMax[1] - ((price - lp) / (hp - lp) * info.yMax[1])

                let [openPosition, highPosition, lowPosition, closePosition] = candle.slice(1)
                    .map(x => Math.floor(calculatePosition(x)))

                // A pixel for candle centered along X axis.
                let currentStep = Math.floor(idx * timeSlot);

                if (openPosition > closePosition) { // x,y,w,h
                    let height = openPosition - closePosition;
                    this.renderLine([currentStep, lowPosition], [currentStep, highPosition], "red");
                    this.context.fillStyle = "#f25252";
                    this.context.fillRect(currentStep - 5, closePosition, 10, height);
                    this.context.strokeStyle = "red"
                    this.context.beginPath();
                    this.context.rect(currentStep - 5, closePosition, 10, height);
                    this.context.stroke();
                } else {
                    let height = closePosition - openPosition;
                    this.renderLine([currentStep, lowPosition], [currentStep, highPosition], "green");
                    this.context.fillStyle = "#52f275";
                    this.context.fillRect(currentStep - 5, openPosition, 10, height);
                    this.context.strokeStyle = "green"
                    this.context.beginPath();
                    this.context.rect(currentStep - 5, openPosition, 10, height);
                    this.context.stroke();
                }
                candleOhlcMappings.push({
                    idx: idx,
                    step: currentStep,
                    positions: {
                        openPosition: openPosition,
                        lowPosition: lowPosition,
                        highPosition: highPosition,
                        closePosition: closePosition
                    }
                });
                idx++;
            }
        }
    }


    function renderInfo(context, mousePos) {
        renderLine(context, [0, mousePos.y], [GLOBAL_WIDTH, mousePos.y], "black");
        renderLine(context, [mousePos.x, 0], [mousePos.x, GLOBAL_HEIGHT], "black");
    }


    function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
        };
    }


    const Chart = options => {
        w: options.w
        h: options.h
        ylines: options.ylines
        xlines: options.xlines
    }

    function process(data) {
        // split the data set into ohlc and volume
        var i = 0;
        var ohlc = [];
        var volume = [];
        let hp = 0;
        let lp = Infinity;
        let dateRange = ["", ""];
        var dataLength = data['Time Series (Daily)'];

        for (var time in dataLength) {
            var stock_info = dataLength[time];
            let newOHLC = [
                time,
                Number(stock_info["1. open"]),
                Number(stock_info["2. high"]),
                Number(stock_info["3. low"]),
                Number(stock_info["4. close"])
            ];

            ohlc.push(newOHLC);

            if (i == 0) {//set max/min date
                dateRange[0] = newOHLC[0];
            }
            if (newOHLC[2] > hp) { //found highest point
                hp = newOHLC[2];
            }
            if (newOHLC[3] < lp) { //found the lowest point
                lp = newOHLC[3];
            }
            volume.push([
                time, // the date                   
                Number(stock_info["5. volume"]) // the volume
            ]);

            i += 1;
        }

        let addEvent = () => {
            let state = "loading";
            canvas.addEventListener('mousemove', function (evt) {
                if (state === "progress") {
                    return;
                }
                state == "progress";
                var mousePos = getMousePos(canvas, evt);
                var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;


                var img = new Image();
                img.onload = function () {
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                }
                img.src = dataUri;
                renderInfo(mousePos);
                state == "finished";
            }, false);
        }

        setTimeout(addEvent, 500);

        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, GLOBAL_WIDTH, GLOBAL_HEIGHT);
        ctx.fillStyle = "black";

        //set max/min date
        dateRange[1] = ohlc[i - 1][0];
        let renderer = new Renderer(ctx)
        let steps = calculateSteps(GLOBAL_WIDTH, GLOBAL_HEIGHT, GLOBAL_XLINES, GLOBAL_YLINES, info)

        renderer.renderGrid(lp, hp, dateRange, steps);
        renderer.renderTicks(ohlc, dateRange, lp, hp, steps)

        var dataUri = canvas.toDataURL();

    }


    window.onload = function () {
        process(DATA);
    }

</script>

</html>